<?php
//R_26579
require_once 'consulta_stock_insumos_funciones.php';
require_once 'funciones.php';
require_once 'areas_sectores_turnos_puestos__funciones.php';

if (!isset($_POST['operacion'])) {
    echo '<input type="hidden" id="sesioncaducada">';
    die();
} else {
    $operacion = $_POST['operacion'];
}

switch($operacion){

    case 1:  

        
        if ( $_SESSION['idAreaSector'] == 2 ||  $_SESSION['idAreaSector'] == 26 ||  $_SESSION['idAreaSector'] == 73){
            $id_area_sector_filtro = NULL;
        } else {
            $id_area_sector_filtro = $_SESSION['idAreaSector'];
        }

        
        //echo $rs;
        
                
        $html = "<table width='50%' align='center' style='margin-top:20px;'>
                    <tr>
                        <td colspan=3 class='subtitulo' style='text-align:center;'> CONSULTA DE STOCK ÁREA PRODUCCIÓN </td>
                    </tr>
                    <tr>
                    
                        <td aling='center' width='10%' class='trlabelturnos' style='text-align:center;'>Insumo: </td>
                        <td width='10%';'>

                        <select style='font-size:15px;width:390px' id='area_sector_filtro' class='' onchange='limpiar_consulta()'>
                            <option value='seleccion'>Seleccione</option>";
                            
                            $rs = obtener_insumo_area_sector($id_area_sector_filtro);
                            while (($row = mysql_fetch_object($rs)) != null){
                                $descripcion_insumo = insumos__get_Descripcion($row->id_insumo);
                                $html .= "<option value='$row->id_insumo'>$descripcion_insumo</option>";
                            }
        $html .=            "<td style='text-align:center;' valign='bottom'>
                                <input type='button' id='btn_mostrar_detalle_insumos' style='visibility:hidden' class='boton5' value='CONSULTAR' onclick='mostrar_detalle_stock_insumos()'>
                            </td>";
                  
        $html .=           "</select>
                        </td>
                    </tr>
                </table>

                <div id='detalle_stock_insumos'></div>;";  
                
        echo $html;
        break;


    case 2:

        $id_insumo = $_POST['id_insumo'];

        if ( $_SESSION['idAreaSector'] == 2 ||  $_SESSION['idAreaSector'] == 26 ||  $_SESSION['idAreaSector'] == 73){
           
            $html = "<table width='50%' align='center' style='margin-top:20px;'>
                    <tr>
                    <td colspan=4 width='100%'colspan=4 class='subtitulo' style='text-align:center;'> DETALLE STOCK INSUMO </td>
                    </tr>
                    <tr>
                        <td colspan=1 class='subtitulo' style='text-align:center;'> SECTOR </td> 
                        <td colspan=1 class='subtitulo' style='text-align:center;'> CANTIDAD </td>
                        <td colspan=1 class='subtitulo' style='text-align:center;'> ACCION </td>
                    </tr>";

            //para obtener los id area sector  en base al id_insumo que se elige en el combo
            $rs = obtener_area_sector_insumos_auditables($id_insumo);
            $cont = 0;

            while (($row = mysql_fetch_object($rs)) != null){

                if ($cont % 2 == 0) {
                    $clase = "fpar";
                } else {
                    $clase = "fimpar";
                }
                
                $id_area_sector = $row->id_area_sector_destino;
                $cant_total_stock =  obtener_stock_actual_por_insumo_y_id_sector ($id_area_sector, $id_insumo);

                $html .= "<tr class='$clase'> 
                <td colspan=1 class='' style='text-align:center;'> $row->descripcion </td>";

                if($cant_total_stock == false){
                    $html .= "<td colspan=1 class='' style='text-align:center;'> - </td>
                    <td colspan=1 class='' style='text-align:center;'> - </td>";
                } else{
                    $html .= "<td colspan=1 class='' style='text-align:center;'> $cant_total_stock </td>
                    <td colspan=1 class='' style='text-align:center;'> - </td>";
                }
                $cont++;

            } //while

                $html .="</tr>
                        </table>";
                echo $html;
          
            //SINO ES ALGUNO DE LOS 3 PERFILES DEL IF, ENTONCES..                     					
        } else {
            
            $html = "<table width='50%' align='center' style='margin-top:20px;'>
                        <tr>
                            <td colspan=4 width='100%'colspan=4 class='subtitulo' style='text-align:center;'> DETALLE STOCK INSUMO </td>
                        </tr>
                        <tr> 
                            <td colspan=2 class='subtitulo' style='text-align:center;'> CANTIDAD </td>
                            <td colspan=2 class='subtitulo' style='text-align:center;'> ACCIÓN </td>
                        </tr>";

            if ($cont % 2 == 0) {
                $clase = "fpar";
            } else {
                $clase = "fimpar";
            }
            
            $id_area_sector = $_SESSION['idAreaSector'];
            $cant_total_stock =  obtener_stock_actual_por_insumo_y_id_sector ($id_area_sector, $id_insumo);

            if($cant_total_stock == false){
                $html .= "<tr class='$clase'> <td colspan=1 class='' style='text-align:center;'> - </td>";
            } else{
                $html .= "<tr class='$clase'> <td colspan=2 class='' style='text-align:center;'> $cant_total_stock </td>";
            }

            $html .="<td colspan=2 class='' style='text-align:center;'> - </td>
                    </tr>
                    </table>";
            echo $html;
            
        }// else   
    break;                
}//switch
        
        
 




<?php

session_start();
require_once $_POST['ROOT'].'/Especifica/ControlDeStock/FuncionesPHP/funciones_generales.php';
require_once $_POST['ROOT'].'/General/FuncionesPHP/Generales/Funciones_Generales.php';
?>
<script type="text/javascript" src="Stock/Especifica/ControlDeStock/FuncionesJS/insumos_activar_inactivar.js?v<?php echo rand(); ?>"></script>
<?php
$operacion = isset($_POST['operacion']) ? $_POST['operacion'] : '';

switch($operacion){

    case 1:
        ?>
        <table align="center" style="margin-top:2mm;" border="0" width="60%">
        <tr>
        <td colspan="2" class="subtitulo" style="text-align:center;">CONSULTA DE STOCK DE INSUMOS</td>
        </tr>
        <?php
        
        $perfil = $_SESSION["idperfil_remito"];

        if ($perfil == 'BO' || $perfil == 'BP') {

        $rowProv = obtenerProveedoresPorIdPerfil($perfil);
        $cant = mysql_num_rows($rowProv);
        $cantidad = 1;

        while ($row = mysql_fetch_object($rowProv)) {
        if ($cant == 1) {
            $idProveedor.=$row->id;
        }
        if ($cant == $cantidad) {
            $idProveedor.=$row->id;
        } else if ($cant > 1) {
            $idProveedor.=$row->id . ",";
        }
        $cantidad++;
        }
        } else {
        $idProveedor = 'todos';
        }
        ?>
        <tr>
        
        <td width="20%" class="trlabelturnos" style="text-align:right;">Tipo de Insumo: </td>
        <td width="90%" class="" style="padding-top:2mm;">
        <select id="TiposInsumosActivarInactivar" style='width:200px;' onchange='cargarCombosInsumosActivarInactivar();'>
        <option value="nada" >Seleccione</option>
        <?php                    

        

        //se obtienen los distintos tipos de insumos
        $rs = obtenerDistintosTiposInsumosPorIdProveedor($idProveedor);
        while ($row = mysql_fetch_object($rs)) {
            $idTipoInsumo = $row->id_tipo_insumo;
            $descTipoInsumo = utf8_decode($row->descripcion);
            ?>
            <option value="<?php echo $idTipoInsumo; ?>" ><?php echo $descTipoInsumo; ?></option>
            <?php
        }
        ?>
        </select>
        </td>
        </tr>
        <tr>
        <td width="10%" class="trlabelturnos" style="text-align:right;">Insumo: </td>
        <td width="90%" class="" style="" >
        <div id="insumosDiv">
        <select style='width:600px;'>
            <option value="---">---</option>
        </select>
        </div>
        </td>
        </tr>   
        </table>
        <?php

   
    break;

}